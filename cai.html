<!doctype html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
        <meta name="format-detection" content="telephone=no">
        <title>cai</title>
        <script src="deps/zepto.min.js"></script>
        <link href="src/css/reset.css" type="text/css" rel="stylesheet"/>
        <link href="src/css/dian1.css" type="text/css" rel="stylesheet"/>
    </head>
    <body>
        <section id="carousel">
            <ul class="carousel-inner">
                <li class="carousel-active" draggable="true" data-id="1">
                    <img src="http://dummyimage.com/200x150/888/fff" />
                </li>
                <li class="carousel-next" draggable="true">
                    <img src="http://dummyimage.com/200x150/888/fff" />
                </li>
                <li class="carousel-last" draggable="true">
                    <img src="http://dummyimage.com/200x150/ccc/fff" />
                </li>
                <li draggable="true">
                    <img src="http://dummyimage.com/200x150/000/fff" />
                </li>
                <li draggable="true">
                    <img src="http://dummyimage.com/200x150/888/fff" />
                </li>
            </ul>
        </section>
        <section class="food-wrapper">
            <div class="food-container">
                <div class="food-none">请拖拽~</div>
            </div>
        </section>
        <script>
            var x = 320 / 2 - 200 / 2;
            $('.carousel-inner li').each(function(index, li) {
                $(li).data('data-index', index);
            });
            $('#carousel li').on('click', function(event) {
                var target = this;
                var active = $('.carousel-active');
                if(target == active[0]) {
                    return;
                }

                target = $(target);
                var index = target.data('data-index');
                index = parseInt(index);
                var currentIndex = active.data('data-index');
                currentIndex = parseInt(currentIndex);

                if(index > currentIndex) {
                    // 后面一张图片
                    target.removeClass().addClass('carousel-active');
                    target.next().removeClass().addClass('carousel-next');
                    target.next().next().removeClass().addClass('carousel-last');
                    active.removeClass().addClass('carousel-prev');
                    active.prev().removeClass().addClass('carousel-first');
                    active.prev().prev().removeClass();
                } else {
                    // 前面一张图片
                    target.removeClass().addClass('carousel-active');
                    target.prev().removeClass().addClass('carousel-prev');
                    target.prev().prev().removeClass().addClass('carousel-fisrst');
                    active.removeClass().addClass('carousel-next');
                    active.next().removeClass().addClass('carousel-last');
                    active.next().next().removeClass();
                }

            });

            $('#carousel li').on('dragstart', function(event) {
                event.dataTransfer.effectAllowed = 'copy'; 
                event.dataTransfer.setData('id', $(this).data('id'));
            });

            var wrapper = $('.food-wrapper')[0];
            wrapper.addEventListener('dragover', function(event) {
                if (event.preventDefault) event.preventDefault();
                event.dataTransfer.dropEffect = 'copy';

                $(this).addClass('food-drag-over');
                return false;
            });
            wrapper.addEventListener('dragenter', function() {
                $(this).addClass('food-drag-over');
                return false;
            });
            wrapper.addEventListener('dragleave', function() {
                $(this).removeClass('food-drag-over');
                return false;
            });
            wrapper.addEventListener('drop', function(event) {
                if (event.stopPropagation) event.stopPropagation();

                console.log(event.dataTransfer.getData('id'));
                $(this).removeClass('food-drag-over');
                return false;
            });

        </script>
    </body>
</html>
